import streamlit as st
import pandas as pd

# --- ダイアログ（モーダルウィンドウ）の定義 ---
# width="large" に設定（operation_manual.pyと同様）
@st.dialog("📋 取込ヘッダー定義一覧", width="large")
def show_header_definitions():
    # --- CSS定義 ---
    # operation_manual.py に合わせ、ダイアログ内の表示を調整するためのCSS
    st.markdown("""
        <style>
        /* ダイアログ内の見出し余白調整 */
        .stMarkdown h3 {
            margin-top: 0px !important;
        }
        </style>
    """, unsafe_allow_html=True)

    # --- スクロールエリアの定義 ---
    # height=700 (ピクセル), border=True (operation_manual.pyと同様のコンテナ設定)
    with st.container(height=700, border=True):
        
        st.markdown("""
        ### 📥 インポート時の参照列定義
        
        本アプリが各ポータルのデータファイルを取り込む際、自動的に参照している列名（ヘッダー）の一覧です。
        <br>ファイルの取り込みエラーやデータの不整合が発生する場合は、お手元のファイル内に下記のヘッダー名が存在するかをご確認ください。
        
        ---
        """, unsafe_allow_html=True)

        st.error("※「チョイス」「チョイス在庫」はCSVの仕様上ヘッダー行を持たないため、列の順番（インデックス）で判定しています。")

        # データ定義
        data = [
            {"ポータル": "チョイス", "コード列": "CY列 (103列目)", "名称列": "C列 (3列目)", "備考": "※ヘッダー行なし。列位置で判定"},
            {"ポータル": "チョイス在庫", "コード列": "-", "名称列": "-", "備考": "※A列（「お礼の品ID」）をキーに在庫情報を紐づけ"},
            {"ポータル": "楽天", "コード列": "商品番号", "名称列": "商品名", "備考": "「システム連携用SKU番号」も参照"},
            {"ポータル": "ANA", "コード列": "返礼品識別コード", "名称列": "返礼品名", "備考": ""},
            {"ポータル": "ふるなび", "コード列": "外部返礼品コード", "名称列": "返礼品名", "備考": ""},
            {"ポータル": "JAL", "コード列": "返礼品番号", "名称列": "返礼品名", "備考": ""},
            {"ポータル": "まいふる", "コード列": "返礼品番号", "名称列": "返礼品名", "備考": ""},
            {"ポータル": "マイナビ", "コード列": "返礼品番号", "名称列": "返礼品名", "備考": ""},
            {"ポータル": "プレミアム", "コード列": "SKU", "名称列": "返礼品名", "備考": ""},
            {"ポータル": "JRE", "コード列": "自治体管理番号", "名称列": "商品名", "備考": ""},
            {"ポータル": "さとふる", "コード列": "お礼品予備項目", "名称列": "お礼品名", "備考": ""},
            {"ポータル": "さとふる在庫", "コード列": "-", "名称列": "-", "備考": "「お礼品ID」をキーに在庫情報を紐づけ"},
            {"ポータル": "Amazon", "コード列": "出品者SKU", "名称列": "-", "備考": ""},
            {"ポータル": "百選", "コード列": "返礼品コード", "名称列": "返礼品名称", "備考": ""},
            {"ポータル": "百選在庫", "コード列": "-", "名称列": "-", "備考": "「返礼品コード」をキーに在庫情報を紐づけ"},
            {"ポータル": "ぐるなび", "コード列": "商品番号", "名称列": "商品名", "備考": ""},
            {"ポータル": "あとギフ", "コード列": "返礼品コード", "名称列": "返礼品名*", "備考": ""},
        ]

        df = pd.DataFrame(data)

        # テーブルの表示
        st.dataframe(
            df,
            column_config={
                "ポータル": st.column_config.TextColumn("ポータル名", width="medium"),
                "コード列": st.column_config.TextColumn("返礼品コード列", width="medium"),
                "名称列": st.column_config.TextColumn("返礼品名列", width="medium"),
                "備考": st.column_config.TextColumn("備考", width="large"),
            },
            hide_index=True,
            width='stretch'
        )
        
        st.markdown("""
        <div style="margin-top: 15px;"></div>
        
        #### 💡 注意事項
        * **CSV/Excelファイルの1行目**にある項目名が、上表の「参照列」と**完全一致**している必要があります。（余分なスペース等が含まれていないかご注意ください）
        * 「楽天」はCSVの仕様上、複数のファイルがインポート対象となるため、項目の網羅性に注意してください。（詳細は「操作マニュアル」を参照）
        """, unsafe_allow_html=True)